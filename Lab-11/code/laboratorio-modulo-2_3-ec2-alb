
============================================
     EJECUCIÃ“N - CLOUD9
============================================


1. Lanzar Cloud9

2. Ejecutar los siguientes comandos:

#Ingresar el nombre de los Stacks de CloudFormation
CLOUDFORMATION_1=lab-networking
CLOUDFORMATION_2=lab-ec2-coffee


sudo apt-get install jq -y
aws cloudformation describe-stacks --stack-name $CLOUDFORMATION_1 | jq -r '.Stacks[] | .Outputs[] | .ExportName' >> tmp_1
aws cloudformation describe-stacks --stack-name $CLOUDFORMATION_1 | jq -r '.Stacks[] | .Outputs[] | .OutputValue' >> tmp_2
aws cloudformation describe-stacks --stack-name $CLOUDFORMATION_2 | jq -r '.Stacks[] | .Outputs[] | .ExportName' >> tmp_1
aws cloudformation describe-stacks --stack-name $CLOUDFORMATION_2 | jq -r '.Stacks[] | .Outputs[] | .OutputValue' >> tmp_2
paste tmp_1 tmp_2 > output


#Ingresar el ID de la AMI a utilizar
AMI_ID=ami-03dec471e41ad7cf2
PRIVATESUBNET_A=$(cat output | awk 'NR ==6 { print $2 }')
PRIVATESUBNET_B=$(cat output | awk 'NR ==2 { print $2 }')
SEGURITYGROUP_ID=$(cat output | awk 'NR ==12 { print $2 }')
#Ingresar el nombre del Key Pair, no el ID
KEYPAIR_ID=13082021
IAMINSTANCEPROFILE=$(cat output | awk 'NR ==11 { print $2 }')


echo $AMI_ID
echo $PRIVATESUBNET_A
echo $PRIVATESUBNET_B
echo $SEGURITYGROUP_ID
echo $KEYPAIR_ID
echo $IAMINSTANCEPROFILE


#Private Subnet AZ-A
aws ec2 run-instances --image-id $AMI_ID \
    --instance-type t2.micro \
    --subnet-id $PRIVATESUBNET_A \
    --security-group-ids $SEGURITYGROUP_ID \
    --key-name $KEYPAIR_ID \
	--iam-instance-profile Name=$IAMINSTANCEPROFILE \
	--tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value="EC2 BACKEND PRIVATE A"}]'


#Private Subnet AZ-B
aws ec2 run-instances --image-id $AMI_ID \
    --instance-type t2.micro \
    --subnet-id $PRIVATESUBNET_B \
    --security-group-ids $SEGURITYGROUP_ID \
    --key-name $KEYPAIR_ID \
	--iam-instance-profile Name=$IAMINSTANCEPROFILE \
	--tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value="EC2 BACKEND PRIVATE B"}]'
	
rm tmp*
rm output


3. Crear el recurso "Target Group"

4. Crear el recursos "Application Load Balancer" (ALB)

